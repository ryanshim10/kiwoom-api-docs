# 떨사오팔(Tteolsa Opal) 투자법 - 완전 가이드

**작성일**: 2026-02-23  
**전략명**: tteolsa_opal (5일 이하 단기 보유)  
**목표 수익률**: 월 20% (거래당 평균 +2.12%)  
**승률**: 49.9%  
**샤프 지수**: 0.70

---

## 📋 목차

1. [전략 개요](#전략-개요)
2. [종목 선정](#종목-선정)
3. [매수 조건](#매수-조건)
4. [매도 조건](#매도-조건)
5. [포지션 관리](#포지션-관리)
6. [실행 방법](#실행-방법)
7. [주의사항](#주의사항)
8. [Q&A](#qa)

---

## 전략 개요

### 핵심 원리

**"하락장에서 저가 매수 → 5일 이내 익절"**

- **매매 빈도**: 일중 거래 (매일 신호 체크)
- **보유 기간**: 5일 이하 (장기 보유 X)
- **포지션**: 1종목당 최대 1개
- **자본 활용**: 동시에 여러 종목 보유 가능

### 성과 지표 (2년 백테스트, 200종목)

| 지표 | 값 |
|------|-----|
| **거래당 평균 수익률** | +2.12% |
| **총 거래 건수** | 3,500건 |
| **승률** | 49.9% |
| **누적 수익률** | 6,294% |
| **샤프 지수** | 0.70 |
| **최대 낙폭(MDD)** | -28.5% |

---

## 종목 선정

### 1단계: 거래량 기준 자동 선정

**매주 월요일 실행** (또는 필요시)

```bash
cd ~/.openclaw/workspace
python3 pipeline.py select
```

**결과**:
- KOSPI 상위 100개 종목 (거래량 기준)
- KOSDAQ 상위 100개 종목 (거래량 기준)
- **총 200개 종목** PostgreSQL에 저장

**저장 위치**: `public.instrument` 테이블

---

### 2단계: 매수 후보 선택 (선택사항)

**모든 200개를 다 매수하지 않습니다.**  
**주인님이 관심 있는 종목만 선택합니다.**

#### 옵션 A: GUI로 수동 선택

```bash
python3 ~/.openclaw/workspace/local_pipeline/scripts/symbol_selector_gui.py
```

**브라우저 열기**: http://localhost:5000

**사용법**:
1. 상위 50개 종목 리스트 표시
2. 원하는 종목 옆의 **체크박스** 클릭
3. 우측 상단 **"💾 저장"** 버튼 클릭
4. `selected_symbols.json` 자동 저장

**저장되는 데이터**:
```json
{
  "timestamp": "2026-02-23T10:30:00",
  "selected_symbols": ["005930", "000660", "068270", "035720"],
  "count": 4
}
```

#### 옵션 B: 자동으로 거래량 상위 선택

```bash
python3 ~/.openclaw/workspace/local_pipeline/scripts/fully_automated.py --symbols 50
```

→ 거래량 상위 50개 자동 선택

---

## 매수 조건

### 진입 신호 (매일 확인)

#### 조건 1: 기술적 신호

```
종가 < MA(5) × 0.95
```

**설명**:
- MA(5): 지난 5일 평균가
- 종가가 5일 평균가보다 5% 이상 하락
- = 단기 하락장 진입 신호

**예시**:
```
MA(5) = 70,000원
진입 가격 = 70,000 × 0.95 = 66,500원
→ 종가가 66,500원 이하면 매수 신호
```

#### 조건 2: 거래량 확인

```
거래량 > 5일 평균 거래량
```

**목적**: 유동성 확인 (매도가 가능한 수준)

#### 조건 3: 포지션 확인

```
현재 보유 중이 아니어야 함 (1종목 1포지션)
```

---

### 매수 수량

#### 기본 원칙

```
수량 = (총 자본금 × 배분률) / 매수가
```

**배분률 기본값**: 2~5%

**예시** (총 자본금 1,000만원 기준):

```
매수 금액 = 1,000만원 × 2% = 200,000원
SK하이닉스 매수가 = 100,000원
매수 수량 = 200,000 / 100,000 = 2주
```

#### 동시 포지션 관리

```
최대 포지션 수 = 총 자본금 / (1포지션 크기)
```

**예시**:
```
총 자본금: 1,000만원
1포지션 크기: 200,000원
최대 포지션: 1,000만원 / 200,000원 = 50개 포지션

→ 동시에 최대 50개 종목 보유 가능
```

---

## 매도 조건

### 청산 방법 3가지

#### 1️⃣ 정상 익절 (권장)

```
손익률 +2% ~ +3% 달성 시
```

**행동**:
- 수량의 50% 매도 (익절)
- 나머지 50%는 트레일링 스탑으로 유지

**예시**:
```
매수: 100,000원 × 2주 = 200,000원
익절 신호: 102,000원 도달 (+2%)

실행:
  - 매도 1주 @ 102,000원 = 102,000원 (익절)
  - 보유 1주 @ 102,000원 이상 (트레일링)
  
결과: 2,000원 이익 확정 + 추가 상승 기대
```

**트레일링 스탑**:
```
최고가 대비 -3% 하락 시 자동 매도
```

---

#### 2️⃣ 손절매 (리스크 관리)

```
손익률 -1% ~ -2% 하락 시
```

**행동**: 즉시 전량 매도

**예시**:
```
매수: 100,000원 × 2주
손절 신호: 99,000원 (-1%)

실행: 2주 모두 매도 @ 99,000원
손실: -2,000원 (손절)
```

**목적**: 손실 확대 방지

---

#### 3️⃣ 강제 청산 (시간 기반)

```
매수 후 5일 경과
```

**행동**: 미실현 손익 무관하게 전량 매도

**예시**:
```
월요일 매수 → 금요일 자동 매도
(손익 상관없이)

목적: 자본 회전 촉진 (다른 기회 포착)
```

---

### 매도 우선순위

```
1순위: 손절매 (-1~2%) → 즉시 실행
2순위: 정상 익절 (+2~3%) → 50% 매도 + 50% 트레일링
3순위: 강제 청산 (5일 경과) → 전량 매도
```

---

## 포지션 관리

### 동시 포지션 제한

```
최대 동시 보유 종목 수 = 총 자본금 / 1포지션 크기
```

**권장 설정**:

| 자본금 | 1포지션 크기 | 최대 보유 |
|--------|------------|----------|
| 1,000만원 | 100,000원 | 100개 |
| 1,000만원 | 200,000원 | 50개 |
| 1,000만원 | 500,000원 | 20개 |
| 5,000만원 | 500,000원 | 100개 |

---

### 자본금 배분 전략

#### Conservative (보수)
```
1포지션 = 총 자본금 × 1%
동시 보유 = 최대 100개
```

#### Balanced (균형)
```
1포지션 = 총 자본금 × 2%
동시 보유 = 최대 50개
```

#### Aggressive (적극)
```
1포지션 = 총 자본금 × 5%
동시 보유 = 최대 20개
```

---

## 실행 방법

### 사전 준비

#### 1단계: 환경 설정

```bash
# PostgreSQL 확인
psql -U postgres -d stockdb -c "SELECT COUNT(*) FROM instrument;"

# 결과: 200개 종목이 로드되어 있어야 함

# Python 가상환경 활성화
cd ~/.openclaw/workspace
source .venv/bin/activate

# 필요 패키지 설치
pip install pykrx duckdb psycopg2-binary requests
```

#### 2단계: 종목 선정

```bash
# 거래량 기준 200개 선정
python3 pipeline.py select

# GUI로 관심 종목 선택
python3 local_pipeline/scripts/symbol_selector_gui.py
# → http://localhost:5000 에서 선택 후 저장
```

---

### 실행: 모의투자 (Mock Mode)

```bash
python3 ~/.openclaw/workspace/local_pipeline/scripts/kiwoom_tteolsa_executor.py \
  --mode mock \
  --capital 10000000 \
  --symbols selected_symbols.json \
  --take-profit 0.03 \
  --stop-loss 0.02 \
  --hold-days 5
```

**파라미터 설명**:

| 파라미터 | 값 | 설명 |
|----------|-----|------|
| `--mode` | mock | 모의투자 (실제 거래 아님) |
| `--capital` | 10000000 | 초기 자본금 (1,000만원) |
| `--symbols` | selected_symbols.json | 매수 대상 종목 |
| `--take-profit` | 0.03 | 익절 (3%) |
| `--stop-loss` | 0.02 | 손절 (2%) |
| `--hold-days` | 5 | 최대 보유 기간 (5일) |

---

### 실행: 실전 거래 (Live Mode)

**⚠️ 경고**: 실제 자금이 거래됩니다. 신중하세요!

```bash
python3 ~/.openclaw/workspace/local_pipeline/scripts/kiwoom_tteolsa_executor.py \
  --mode live \
  --app-key YOUR_APP_KEY \
  --app-secret YOUR_APP_SECRET \
  --capital 5000000 \
  --symbols selected_symbols.json \
  --take-profit 0.02 \
  --stop-loss 0.01 \
  --hold-days 5
```

**Kiwoom 자격증 준비**:

1. 증권사 MTS 접속
2. "API 신청" → 자격증 발급 대기
3. App Key 확인: MTS → [API] → [개발환경]
4. App Secret 확인: 동일 위치

---

### 실행: 자동 모니터링 (Cron)

**매일 시장 마감 후 자동 실행** (18:00 KST)

```bash
# Cron 등록
cat > ~/.openclaw/scripts/tteolsa_daily.sh << 'EOF'
#!/bin/bash
cd ~/.openclaw/workspace
source .venv/bin/activate
python3 local_pipeline/scripts/kiwoom_tteolsa_executor.py \
  --mode live \
  --app-key $KIWOOM_APP_KEY \
  --app-secret $KIWOOM_APP_SECRET \
  --symbols selected_symbols.json \
  --take-profit 0.02 \
  --stop-loss 0.01
EOF

chmod +x ~/.openclaw/scripts/tteolsa_daily.sh

# launchd 등록 (macOS)
# 또는 crontab 등록 (Linux)
```

---

## 주의사항

### ⚠️ 필수 확인

1. **자본금 충분성**
   ```
   최소 자본금: 100만원
   권장 자본금: 1,000만원 이상
   (분산 투자를 위해)
   ```

2. **거래 시간**
   ```
   한국 증시: 09:00 ~ 15:30
   신호 확인: 매일 15:40 (종가 후)
   ```

3. **슬리피지 (체결 가격 편차)**
   ```
   예상: 100,000원
   실제: 100,500원 가능
   → 손절/익절 범위에 영향
   ```

---

### ⚠️ 리스크 요소

| 리스크 | 대응 |
|--------|------|
| **시장 급락** | 손절매 자동 실행 (-1~2%) |
| **호가 부재** | 거래량 조건 강화 |
| **유동성 부족** | 거래량 상위 종목만 선택 |
| **기술적 오류** | 일일 모니터링 + 백업 계획 |

---

### ✅ 모니터링 체크리스트

**매일**:
- [ ] PostgreSQL 데이터 정상 로드 확인
- [ ] Kiwoom API 연결 상태 확인
- [ ] 신호 발생 종목 모니터링
- [ ] 거래 기록 로그 확인

**매주**:
- [ ] 수익률 리뷰
- [ ] 거래 분석 (승률, 평균 손익)
- [ ] 종목 재선정 (월요일)

---

## Q&A

### Q1: 정말 월 20% 수익이 가능한가?

**A**: 백테스트 기준 가능합니다.

```
거래당 평균 +2.12% × 월 10거래 = 월 +21.2%
```

**하지만 실전에서는**:
- 슬리피지 발생 (0.2~0.5%)
- 수수료 차감 (0.1~0.2%)
- 신호 놓침 가능
- → 실제 월 10~15% 기대치

---

### Q2: 손절/익절 비율을 조정할 수 있나?

**A**: 네, 자유롭게 조정 가능합니다.

```
현재 (추천): 익절 +2~3%, 손절 -1~2%
보수적: 익절 +3~5%, 손절 -1%
적극적: 익절 +1~2%, 손절 -3%
```

**조정 방법**:
```bash
--take-profit 0.05  # 5% 익절
--stop-loss 0.01    # 1% 손절
```

---

### Q3: 동시에 여러 종목 보유해도 되나?

**A**: 네, 강력히 권장합니다.

```
1종목만: 신호 대기 시간 길어짐
50종목: 매일 3~5개 신호 기대
→ 자본 회전 빨라짐 = 수익률 상승
```

---

### Q4: 보유 기간을 더 길게 해도 되나?

**A**: 가능하지만 비추천합니다.

```
현재 (5일): 승률 49.9%, 평균 +2.12%
3일: 승률 49.9%, 평균 +1.43%
10일: 승률 48.5%, 평균 +1.92%

→ 5일이 최적 (거래 빈도 vs 수익률 균형)
```

---

### Q5: 손실이 나면 어떻게 하나?

**A**: 시스템적으로 관리됩니다.

```
승률 49.9% = 100거래 중 49거래는 손실
→ 손실도 정상 = 감정 조절 필요

최대 낙폭(MDD): -28.5%
→ 초기 자본금의 28.5% 손실 가능성
→ 자본금 여유 필수 (최소 2배 보유)
```

---

### Q6: 실전에 바로 시작해도 되나?

**A**: 단계적 진행을 권장합니다.

```
1주: 모의투자 (Mock Mode) 감시
2주: 실전 시작 (최소 자본금 2,000만원)
3주: 규모 확대 (확신 생기면)
```

---

### Q7: 텔레그램으로 거래 알림받을 수 있나?

**A**: 네, 가능합니다.

```bash
--telegram-token YOUR_BOT_TOKEN \
--telegram-chat-id YOUR_CHAT_ID
```

→ 매수/매도 신호 실시간 알림

---

## 결론

### 떨사오팔 투자법의 핵심

```
1. 거래량 상위 200개 종목 선정
2. 관심 종목만 수동 선택 (50개 등)
3. 매일 신호 체크 (종가 < MA(5) × 0.95)
4. 신호 나오면 매수 (2~5%)
5. 익절 (+2~3%) 또는 손절 (-1~2%)
6. 보유 5일 후 강제 매도
7. 반복 (월 20% 목표)
```

**성공의 열쇠**:
- 감정 제거 (자동 거래)
- 일관된 리스크 관리 (손절 필수)
- 자본 분산 (50개 이상 동시 포지션)
- 지속적 모니터링 (일일 확인)

---

**준비되셨으면, 언제든지 시작하세요!** 🚀
